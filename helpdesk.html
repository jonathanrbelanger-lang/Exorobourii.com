<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Terminal Access | Exorobourii</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    /* --- FONTS & VARS --- */
    @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;600&family=VT323&display=swap');

    :root {
      --bg-color: #050505;
      --glass-color: #101214;
      --phosphor-main: #38bdf8; /* Cyan */
      --phosphor-dim: #0ea5e9;
      --phosphor-alert: #ef4444;
      --phosphor-success: #22c55e;
      --phosphor-warn: #fbbf24;
    }

    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      height: 100vh;
      width: 100vw;
      background-color: var(--bg-color);
      color: var(--phosphor-main);
      font-family: 'Fira Code', monospace;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* --- CRT CHASSIS --- */
    .monitor-casing {
      width: 100%;
      height: 100%;
      position: relative;
      background: #000;
      overflow: hidden;
    }

    .screen {
      position: relative;
      width: 100%;
      height: 100%;
      background-color: var(--glass-color);
      overflow: hidden;
      box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
      animation: turnOn 3s linear;
      display: flex;
      flex-direction: column;
    }

    /* --- EFFECTS --- */
    .scanlines {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 50;
    }

    .rgb-split {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 51;
      background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.4) 100%);
      mix-blend-mode: overlay;
    }

    @keyframes flicker {
      0% { opacity: 0.97; }
      50% { opacity: 0.95; }
      100% { opacity: 0.97; }
    }

    @keyframes turnOn {
      0% { transform: scale(1, 0.002); opacity: 0; filter: brightness(0); }
      50% { transform: scale(1, 0.002); opacity: 1; filter: brightness(1); }
      100% { transform: scale(1, 1); opacity: 1; }
    }

    /* --- NAVIGATION --- */
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      border-bottom: 2px solid var(--phosphor-dim);
      background: rgba(0,0,0,0.8);
      z-index: 60;
      position: relative;
    }

    .brand {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--phosphor-main);
      text-decoration: none;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 5px var(--phosphor-main);
    }

    .nav-links { display: flex; gap: 2rem; }

    .nav-links a {
      color: var(--phosphor-dim);
      text-decoration: none;
      font-size: 0.9rem;
      text-transform: uppercase;
      transition: all 0.2s;
    }

    .nav-links a:hover {
      color: var(--phosphor-main);
      text-shadow: 0 0 8px var(--phosphor-main);
      text-decoration: underline;
    }

    /* --- TERMINAL AREA --- */
    .terminal-wrapper {
      flex: 1;
      position: relative;
      padding: 2rem;
      z-index: 10;
      display: flex;
      flex-direction: column;
      text-shadow: 0 0 5px var(--phosphor-dim);
      animation: flicker 0.15s infinite;
      overflow: hidden;
    }

    #matrixCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.15;
      z-index: 1;
    }

    #output {
      flex: 1;
      overflow-y: auto;
      font-size: 1rem;
      line-height: 1.5;
      scrollbar-width: none;
      padding-bottom: 20px;
    }
    #output::-webkit-scrollbar { display: none; }

    .input-line {
      display: flex;
      align-items: center;
      background: rgba(0,0,0,0.6);
      padding: 10px 0;
      margin-top: 10px;
    }
    
    .prompt {
      color: var(--phosphor-success);
      margin-right: 10px;
      white-space: nowrap;
      font-weight: bold;
    }

    input#cli {
      background: transparent;
      border: none;
      color: var(--phosphor-main);
      font-family: 'Fira Code', monospace;
      font-size: 1rem;
      flex: 1;
      outline: none;
      text-shadow: 0 0 5px var(--phosphor-main);
      caret-color: var(--phosphor-warn);
    }

    /* --- UTILS --- */
    .line { margin-bottom: 4px; white-space: pre-wrap; word-wrap: break-word; }
    .cyan { color: var(--phosphor-main); }
    .green { color: var(--phosphor-success); }
    .red { color: var(--phosphor-alert); }
    .yellow { color: var(--phosphor-warn); }
    .dim { color: #64748b; }
    .bold { font-weight: 600; }
    
    /* --- BOOT SCREEN --- */
    #boot-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      z-index: 100;
      padding: 40px;
      font-family: 'VT323', monospace;
      font-size: 1.4rem;
      color: var(--phosphor-main);
      display: flex;
      flex-direction: column;
    }
    .hidden { display: none !important; }

    /* Mobile */
    @media (max-width: 768px) {
      nav { flex-direction: column; gap: 1rem; padding: 1rem; }
      .nav-links { gap: 1rem; flex-wrap: wrap; justify-content: center; }
      .terminal-wrapper { padding: 10px; }
    }
  </style>
</head>
<body>

<div class="monitor-casing">
  <div class="screen">
    <div class="scanlines"></div>
    <div class="rgb-split"></div>
    
    <!-- BOOT LAYER -->
    <div id="boot-screen">
      <div id="boot-text"></div>
      <div id="click-to-start" style="margin-top: auto; text-align: center; animation: flicker 1s infinite;" class="hidden">
        [ PRESS ANY KEY TO INITIALIZE SYSTEM ]
      </div>
    </div>

    <!-- MAIN UI -->
    <div id="main-interface" class="hidden" style="display: flex; flex-direction: column; height: 100%;">
      <nav>
        <a href="index.html" class="brand">Exorobourii</a>
        <div class="nav-links">
          <a href="mission.html">Mission</a>
          <a href="projects.html">Projects</a>
          <a href="staff.html">Staff</a>
          <a href="helpdesk.html" style="color: var(--phosphor-main); text-decoration: underline;">Helpdesk</a>
        </div>
      </nav>

      <div class="terminal-wrapper" onclick="document.getElementById('cli').focus()">
        <canvas id="matrixCanvas"></canvas>
        <div id="output"></div>
        <div class="input-line">
          <span class="prompt" id="prompt-span">guest@exorobourii:~$</span>
          <input type="text" id="cli" autocomplete="off" spellcheck="false">
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* --- 1. AUDIO ENGINE --- */
const AudioEngine = {
  ctx: null,
  gain: null,
  enabled: true,

  init() {
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    this.ctx = new AudioContext();
    this.gain = this.ctx.createGain();
    this.gain.connect(this.ctx.destination);
    this.gain.gain.value = 0.1; 
  },

  playTone(freq, type, duration) {
    if (!this.ctx) return;
    const osc = this.ctx.createOscillator();
    const gn = this.ctx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
    gn.gain.setValueAtTime(0.05, this.ctx.currentTime);
    gn.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
    osc.connect(gn);
    gn.connect(this.gain);
    osc.start();
    osc.stop(this.ctx.currentTime + duration);
  },

  playKeySound() {
    this.playTone(800 + Math.random() * 200, 'square', 0.05);
  },
  playEnterSound() {
    this.playTone(600, 'square', 0.1);
    this.playTone(300, 'sine', 0.2);
  },
  playError() {
    this.playTone(150, 'sawtooth', 0.3);
    this.playTone(100, 'square', 0.3);
  },
  playBootSound() {
    if (!this.ctx) return;
    const osc = this.ctx.createOscillator();
    const gn = this.ctx.createGain();
    osc.frequency.setValueAtTime(100, this.ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(800, this.ctx.currentTime + 2);
    gn.gain.setValueAtTime(0, this.ctx.currentTime);
    gn.gain.linearRampToValueAtTime(0.2, this.ctx.currentTime + 1);
    gn.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 3);
    osc.connect(gn);
    gn.connect(this.gain);
    osc.start();
    osc.stop(this.ctx.currentTime + 3);
  }
};

/* --- 2. MATRIX EFFECT --- */
const Matrix = {
  canvas: document.getElementById('matrixCanvas'),
  ctx: null,
  chars: "01EXOROBOURII",
  drops: [],
  fontSize: 14,
  
  init() {
    this.ctx = this.canvas.getContext('2d');
    this.resize();
    window.addEventListener('resize', () => this.resize());
    for (let i = 0; i < this.columns; i++) this.drops[i] = Math.random() * -100;
    setInterval(() => this.draw(), 33);
  },

  resize() {
    this.canvas.width = window.innerWidth;
    this.canvas.height = window.innerHeight;
    this.columns = this.canvas.width / this.fontSize;
  },

  draw() {
    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
    this.ctx.fillStyle = '#0F0';
    this.ctx.font = this.fontSize + 'px monospace';

    for (let i = 0; i < this.drops.length; i++) {
      const text = this.chars.charAt(Math.floor(Math.random() * this.chars.length));
      if (Math.random() > 0.98) this.ctx.fillStyle = '#38bdf8'; // Cyan
      else this.ctx.fillStyle = '#0ea5e9'; // Dim Cyan
      
      this.ctx.fillText(text, i * this.fontSize, this.drops[i] * this.fontSize);
      if (this.drops[i] * this.fontSize > this.canvas.height && Math.random() > 0.975) this.drops[i] = 0;
      this.drops[i]++;
    }
  }
};

/* --- 3. FILE SYSTEM --- */
const FileSystem = {
  "~": {
    "projects": { type: "dir", content: ["janus", "vsm", "glass_box.md"] },
    "research": { type: "dir", content: ["whitepaper_vsm.txt", "training_notes.log"] },
    "team": { type: "dir", content: ["founder.txt", "coffee_incident.log"] },
    "helpdesk": { type: "dir", content: ["ticket_template.txt", "faq.txt"] },
    "README.md": { type: "file", content: "# Exorobourii Helpdesk\n\nSubmit tickets via the 'ticket' command.\nExplore the system using standard unix commands." }
  },
  "~/projects": {
    "janus": { type: "dir", content: ["overview.txt"] },
    "vsm": { type: "dir", content: ["metrics.json"] },
    "glass_box.md": { type: "file", content: "# Glass Box\n\nWe believe in interpretable AI." }
  },
  "~/projects/janus": {
    "overview.txt": { type: "file", content: "Janus: Dual-perspective AI training." }
  },
  "~/projects/vsm": {
    "metrics.json": { type: "file", content: "{ \"coherence\": 0.98 }" }
  },
  "~/research": {
    "whitepaper_vsm.txt": { type: "file", content: "VSM Protocol Draft v0.9..." },
    "training_notes.log": { type: "file", content: "Model converging. Coffee machine still sentient." }
  },
  "~/team": {
    "founder.txt": { type: "file", content: "Jonathan Belanger\nFounder & Research Lead" },
    "coffee_incident.log": { type: "file", content: "Incident #847: Machine refused to brew decaf." }
  },
  "~/helpdesk": {
    "ticket_template.txt": { type: "file", content: "To submit a ticket, type 'ticket' and follow the prompts." },
    "faq.txt": { type: "file", content: "Q: Password reset?\nA: We don't use passwords. We use biometrics." }
  }
};

/* --- 4. TERMINAL LOGIC --- */
const Terminal = {
  currentPath: "~",
  history: [],
  historyIndex: -1,
  input: document.getElementById('cli'),
  output: document.getElementById('output'),
  prompt: document.getElementById('prompt-span'),
  isProcessing: false,
  ticketStep: 0, // 0=none, 1=subject, 2=body

  init() {
    this.input.addEventListener('keydown', (e) => this.handleInput(e));
    this.updatePrompt();
  },

  updatePrompt() {
    const path = this.currentPath === "~" ? "~" : this.currentPath.replace("~", "");
    this.prompt.innerHTML = `guest@exorobourii:<span class="cyan">${path}</span>$`;
  },

  async handleInput(e) {
    if (this.isProcessing) { e.preventDefault(); return; }
    
    // Ticket Mode Handling
    if (this.ticketStep > 0 && e.key === 'Enter') {
      const val = this.input.value;
      this.input.value = '';
      AudioEngine.playEnterSound();
      this.handleTicketInput(val);
      return;
    }

    AudioEngine.playKeySound();

    if (e.key === 'Enter') {
      const cmd = this.input.value;
      this.input.value = '';
      this.history.push(cmd);
      this.historyIndex = this.history.length;
      await this.execute(cmd);
      AudioEngine.playEnterSound();
    } 
    else if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (this.historyIndex > 0) {
        this.historyIndex--;
        this.input.value = this.history[this.historyIndex];
      }
    } 
    else if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (this.historyIndex < this.history.length - 1) {
        this.historyIndex++;
        this.input.value = this.history[this.historyIndex];
      } else {
        this.historyIndex = this.history.length;
        this.input.value = '';
      }
    }
    else if (e.key === 'Tab') {
      e.preventDefault();
      this.doTabCompletion();
    }
  },

  doTabCompletion() {
    const val = this.input.value;
    const parts = val.split(' ');
    const last = parts[parts.length - 1];
    const dir = FileSystem[this.currentPath];
    if (!dir) return;
    const matches = Object.keys(dir).filter(k => k.startsWith(last));
    if (matches.length === 1) {
      parts[parts.length - 1] = matches[0];
      this.input.value = parts.join(' ');
    } else if (matches.length > 1) {
      this.print(matches.join('  '), "dim");
    }
  },

  async execute(fullCmd) {
    if (!fullCmd.trim()) return;
    
    // Echo
    const div = document.createElement('div');
    div.innerHTML = `<span class="green">guest@exorobourii:${this.currentPath.replace("~","")}</span>$ ${fullCmd}`;
    this.output.appendChild(div);

    const parts = fullCmd.trim().split(/\s+/);
    const cmd = parts[0].toLowerCase();
    const args = parts.slice(1);

    try {
      switch(cmd) {
        case 'help':
          this.print("AVAILABLE COMMANDS:", "bold cyan");
          this.print("  ls, cd, cat, pwd   : File system");
          this.print("  ticket             : Submit helpdesk ticket");
          this.print("  whoami, date       : User info");
          this.print("  clear              : Clear screen");
          this.print("  mission, projects  : Quick navigation");
          break;

        case 'ls':
          const target = args[0] ? this.resolvePath(args[0]) : this.currentPath;
          const dir = FileSystem[target];
          if (dir) {
            const items = Object.keys(dir).map(k => dir[k].type === 'dir' ? `<span class="cyan">${k}/</span>` : k);
            this.print(items.join('  '));
          } else {
            this.print(`ls: cannot access '${args[0]}': No such directory`, "red");
          }
          break;

        case 'cd':
          if (!args[0] || args[0] === "~") {
            this.currentPath = "~";
          } else if (args[0] === "..") {
            const p = this.currentPath.split('/');
            if (p.length > 1) p.pop();
            this.currentPath = p.join('/') || "~";
          } else {
            const newPath = this.resolvePath(args[0]);
            if (FileSystem[newPath] && FileSystem[newPath].type !== 'file') {
              this.currentPath = newPath;
            } else {
              this.print(`cd: ${args[0]}: No such directory`, "red");
              AudioEngine.playError();
            }
          }
          this.updatePrompt();
          break;

        case 'cat':
          if (!args[0]) { this.print("usage: cat [file]", "yellow"); break; }
          const fpath = this.resolvePath(args[0]);
          const parent = fpath.substring(0, fpath.lastIndexOf('/')) || "~";
          const fname = fpath.substring(fpath.lastIndexOf('/') + 1);
          
          if (FileSystem[parent] && FileSystem[parent][fname]) {
            if (FileSystem[parent][fname].type === 'dir') {
              this.print(`cat: ${fname}: Is a directory`, "red");
            } else {
              await this.streamText(FileSystem[parent][fname].content);
            }
          } else {
            this.print(`cat: ${args[0]}: No such file`, "red");
          }
          break;

        case 'pwd':
          this.print(this.currentPath);
          break;

        case 'whoami':
          this.print("guest (Session ID: " + Math.floor(Math.random()*10000) + ")");
          break;

        case 'date':
          this.print(new Date().toString());
          break;

        case 'clear':
          this.output.innerHTML = '';
          break;

        case 'ticket':
          this.print("--- HELPDESK TICKET SYSTEM ---", "cyan");
          this.print("Please enter the subject of your issue:", "yellow");
          this.ticketStep = 1;
          this.prompt.textContent = "Subject: ";
          break;

        case 'mission':
          window.location.href = "mission.html";
          break;
        case 'projects':
          window.location.href = "projects.html";
          break;
        case 'staff':
          window.location.href = "staff.html";
          break;

        default:
          this.print(`bash: ${cmd}: command not found`, "red");
          AudioEngine.playError();
      }
    } catch (err) {
      console.error(err);
      this.print("System Error: " + err.message, "red");
    }
    
    this.output.scrollTop = this.output.scrollHeight;
  },

  handleTicketInput(val) {
    const div = document.createElement('div');
    div.innerHTML = `<span class="yellow">${this.prompt.textContent}</span> ${val}`;
    this.output.appendChild(div);

    if (this.ticketStep === 1) {
      this.print("Please describe the issue:", "yellow");
      this.ticketStep = 2;
      this.prompt.textContent = "Body: ";
    } else if (this.ticketStep === 2) {
      this.print("Submitting ticket...", "dim");
      setTimeout(() => {
        this.print("Ticket #9942 created successfully.", "green");
        this.print("A representative will ignore this shortly.", "dim"); // Joke
        this.ticketStep = 0;
        this.updatePrompt();
      }, 1000);
    }
    this.output.scrollTop = this.output.scrollHeight;
  },

  resolvePath(path) {
    // Remove trailing slash
    if (path.endsWith('/') && path.length > 1) path = path.slice(0, -1);
    
    if (path.startsWith('~')) return path;
    if (path.startsWith('/')) return '~' + path;
    
    // Handle relative path
    if (this.currentPath === '~') return `~/${path}`;
    return `${this.currentPath}/${path}`;
  },

  print(text, className = "") {
    const div = document.createElement('div');
    div.className = `line ${className}`;
    div.innerHTML = text;
    this.output.appendChild(div);
    this.output.scrollTop = this.output.scrollHeight;
  },

  async streamText(text) {
    this.isProcessing = true;
    const div = document.createElement('div');
    div.className = 'line';
    this.output.appendChild(div);
    for (let char of text) {
      div.innerHTML += char === '\n' ? '<br>' : char;
      this.output.scrollTop = this.output.scrollHeight;
      await new Promise(r => setTimeout(r, 10));
    }
    this.isProcessing = false;
  }
};

/* --- 5. BOOT SEQUENCE --- */
const BootLoader = {
  screen: document.getElementById('boot-screen'),
  text: document.getElementById('boot-text'),
  clickPrompt: document.getElementById('click-to-start'),
  
  async start() {
    await this.print("EXOROBOURII HELPDESK v2.1");
    await this.wait(300);
    await this.print("Initializing Network...");
    await this.print("  - Gateway: 192.168.0.1 [OK]");
    await this.print("  - Firewall: ACTIVE");
    await this.wait(400);
    await this.print("Loading Ticket System...", "cyan");
    
    let bar = "[";
    const barLine = document.createElement('div');
    this.text.appendChild(barLine);
    for(let i=0; i<20; i++) {
      bar += "#";
      barLine.innerHTML = bar + "] " + Math.floor((i/20)*100) + "%";
      await this.wait(20);
    }
    
    await this.print("System Ready.");
    this.clickPrompt.classList.remove('hidden');
    
    const unlock = () => {
      document.removeEventListener('keydown', unlock);
      document.removeEventListener('click', unlock);
      this.enterTerminal();
    };
    document.addEventListener('keydown', unlock);
    document.addEventListener('click', unlock);
  },
  
  enterTerminal() {
    AudioEngine.init();
    AudioEngine.playBootSound();
    this.screen.classList.add('hidden');
    document.getElementById('main-interface').classList.remove('hidden');
    Matrix.init();
    Terminal.init();
  },
  
  print(txt, cls="") {
    const div = document.createElement('div');
    div.className = cls;
    div.innerText = txt;
    this.text.appendChild(div);
    return new Promise(r => setTimeout(r, 100));
  },
  wait(ms) { return new Promise(r => setTimeout(r, ms)); }
};

window.onload = () => BootLoader.start();
</script>
</body>
</html>