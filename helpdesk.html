<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Terminal Access | Exorobourii</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    /* --- CORE VARIABLES --- */
    :root {
      --bg-color: #050505;
      --glass-color: #0a0a0a;
      --phosphor-main: #38bdf8; /* Cyan */
      --phosphor-dim: #0ea5e9;
      --phosphor-alert: #ef4444;
      --phosphor-success: #22c55e;
      --phosphor-warn: #fbbf24;
      --scan-color: rgba(0, 0, 0, 0.5);
      --glitch-color: rgba(255, 255, 255, 0.1);
      --font-stack: 'Courier New', Courier, monospace;
    }

    /* --- RESET & BASE --- */
    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      height: 100vh;
      width: 100vw;
      background-color: #000;
      color: var(--phosphor-main);
      font-family: var(--font-stack);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* --- CRT CHASSIS & SCREEN --- */
    .monitor {
      width: 100%;
      height: 100%;
      position: relative;
      background: #000;
      overflow: hidden;
    }

    .screen {
      position: relative;
      width: 100%;
      height: 100%;
      background-color: var(--glass-color);
      overflow: hidden;
      /* CRT Curvature Effect */
      box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
      animation: turnOn 3s ease-out forwards;
    }

    /* --- OVERLAYS (Pointer Events NONE) --- */
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none; /* CRITICAL FIX: Allows clicking through */
      z-index: 50;
    }

    .scanlines {
      background: linear-gradient(
        to bottom,
        rgba(255,255,255,0),
        rgba(255,255,255,0) 50%,
        rgba(0,0,0,0.2) 50%,
        rgba(0,0,0,0.2)
      );
      background-size: 100% 4px;
    }

    .glow {
      box-shadow: inset 0 0 50px rgba(56, 189, 248, 0.1);
      background: radial-gradient(circle, rgba(56, 189, 248, 0.05) 0%, transparent 80%);
    }

    /* --- CONTENT LAYERS --- */
    #matrix-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.1;
      z-index: 1;
      pointer-events: none;
    }

    .terminal-wrapper {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 2rem;
      z-index: 10;
      display: flex;
      flex-direction: column;
      text-shadow: 0 0 4px var(--phosphor-dim);
    }

    /* --- UI ELEMENTS --- */
    nav {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid var(--phosphor-dim);
      padding-bottom: 10px;
      margin-bottom: 10px;
      opacity: 0;
      transition: opacity 1s;
    }

    .nav-links a {
      color: var(--phosphor-dim);
      text-decoration: none;
      margin-left: 20px;
      font-size: 0.9rem;
      text-transform: uppercase;
    }
    .nav-links a:hover { color: var(--phosphor-main); text-shadow: 0 0 8px var(--phosphor-main); }

    #output {
      flex: 1;
      overflow-y: auto;
      font-size: 1rem;
      line-height: 1.4;
      padding-bottom: 20px;
      scrollbar-width: none; /* Firefox */
    }
    #output::-webkit-scrollbar { display: none; } /* Chrome */

    .input-line {
      display: flex;
      align-items: center;
      background: rgba(0,0,0,0.8);
      padding: 10px 0;
      min-height: 40px;
    }

    .prompt {
      color: var(--phosphor-success);
      margin-right: 10px;
      white-space: nowrap;
      font-weight: bold;
    }

    /* The input is transparent and sits over the cursor */
    input#cli {
      background: transparent;
      border: none;
      color: var(--phosphor-main);
      font-family: var(--font-stack);
      font-size: 1rem;
      flex: 1;
      outline: none;
      caret-color: var(--phosphor-warn);
      text-shadow: 0 0 4px var(--phosphor-main);
    }

    /* --- TEXT STYLES --- */
    .line { margin-bottom: 4px; white-space: pre-wrap; word-wrap: break-word; }
    .cyan { color: var(--phosphor-main); }
    .green { color: var(--phosphor-success); }
    .red { color: var(--phosphor-alert); }
    .yellow { color: var(--phosphor-warn); }
    .dim { color: #64748b; }
    .bold { font-weight: bold; }

    /* --- BOOT SCREEN --- */
    #boot-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      z-index: 100;
      padding: 40px;
      display: flex;
      flex-direction: column;
      font-family: var(--font-stack);
    }
    
    .hidden { display: none !important; }

    /* --- ANIMATIONS --- */
    @keyframes turnOn {
      0% { transform: scale(1, 0.002); opacity: 0; filter: brightness(0); }
      30% { transform: scale(1, 0.002); opacity: 1; filter: brightness(3); }
      60% { transform: scale(1, 0.002); opacity: 1; filter: brightness(1); }
      80% { transform: scale(1, 1); opacity: 1; }
      100% { transform: scale(1, 1); opacity: 1; }
    }

    @keyframes turnOff {
      0% { transform: scale(1, 1); opacity: 1; filter: brightness(1); }
      40% { transform: scale(1, 0.002); opacity: 1; filter: brightness(2); }
      100% { transform: scale(0, 0); opacity: 0; }
    }

    .shutdown { animation: turnOff 0.4s ease-out forwards; }

    /* Mobile */
    @media (max-width: 768px) {
      .terminal-wrapper { padding: 10px; }
      nav { flex-direction: column; gap: 10px; }
    }
  </style>
</head>
<body>

<div class="monitor">
  <div class="screen" id="screen-el">
    <!-- VISUAL LAYERS -->
    <div class="overlay scanlines"></div>
    <div class="overlay glow"></div>
    <canvas id="matrix-canvas"></canvas>

    <!-- BOOT LAYER -->
    <div id="boot-screen">
      <div id="boot-text"></div>
      <div id="click-prompt" style="margin-top: auto; text-align: center; color: var(--phosphor-warn);" class="hidden">
        [ SYSTEM HALTED: PRESS ANY KEY TO INITIALIZE ]
      </div>
    </div>

    <!-- TERMINAL LAYER -->
    <div class="terminal-wrapper hidden" id="main-terminal">
      <nav id="navbar">
        <div class="brand">EXOROBOURII RESEARCH</div>
        <div class="nav-links">
          <a href="mission.html">Mission</a>
          <a href="projects.html">Projects</a>
          <a href="staff.html">Staff</a>
        </div>
      </nav>

      <div id="output"></div>
      
      <div class="input-line">
        <span class="prompt" id="prompt-span">guest@exorobourii:~$</span>
        <input type="text" id="cli" autocomplete="off" spellcheck="false">
      </div>
    </div>
  </div>
</div>

<script>
/**
 * EXOROBOURII HYPER-TERMINAL v2.0
 * 
 * Features:
 * - Web Audio API Synthesizer (Fan, HDD, Keys)
 * - Virtual File System
 * - Canvas Matrix Rain
 * - Focus Trapping
 */

/* --- 1. AUDIO ENGINE (Procedural Sound) --- */
const AudioEngine = {
  ctx: null,
  masterGain: null,
  fanOsc: null,
  
  init() {
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    this.ctx = new AudioContext();
    this.masterGain = this.ctx.createGain();
    this.masterGain.gain.value = 0.15; // Master Volume
    this.masterGain.connect(this.ctx.destination);
    this.startFanHum();
  },

  startFanHum() {
    // Brown noise simulation for computer fan
    const bufferSize = 4096;
    const brownNoise = this.ctx.createScriptProcessor(bufferSize, 1, 1);
    brownNoise.onaudioprocess = (e) => {
      const output = e.outputBuffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        const white = Math.random() * 2 - 1;
        output[i] = (lastOut + (0.02 * white)) / 1.02;
        lastOut = output[i];
        output[i] *= 3.5; 
      }
    };
    let lastOut = 0;
    
    const gain = this.ctx.createGain();
    gain.gain.value = 0.05;
    brownNoise.connect(gain);
    gain.connect(this.masterGain);
  },

  playTone(freq, type, duration, vol = 1) {
    if (!this.ctx) return;
    const osc = this.ctx.createOscillator();
    const gain = this.ctx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
    gain.gain.setValueAtTime(vol, this.ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
    osc.connect(gain);
    gain.connect(this.masterGain);
    osc.start();
    osc.stop(this.ctx.currentTime + duration);
  },

  playKey() {
    // Mechanical click
    this.playTone(600 + Math.random()*200, 'square', 0.05, 0.1);
    this.playTone(100, 'sawtooth', 0.05, 0.1);
  },

  playEnter() {
    // Success chime
    this.playTone(400, 'sine', 0.1, 0.2);
    this.playTone(800, 'sine', 0.2, 0.1);
  },

  playError() {
    // Buzzer
    this.playTone(150, 'sawtooth', 0.2, 0.3);
    this.playTone(100, 'square', 0.2, 0.3);
  },

  playBoot() {
    if (!this.ctx) return;
    const osc = this.ctx.createOscillator();
    const gain = this.ctx.createGain();
    osc.frequency.setValueAtTime(110, this.ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(880, this.ctx.currentTime + 1.5);
    gain.gain.setValueAtTime(0, this.ctx.currentTime);
    gain.gain.linearRampToValueAtTime(0.5, this.ctx.currentTime + 0.1);
    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 2);
    osc.connect(gain);
    gain.connect(this.masterGain);
    osc.start();
    osc.stop(this.ctx.currentTime + 2);
  }
};

/* --- 2. MATRIX RAIN (Canvas) --- */
const Matrix = {
  canvas: document.getElementById('matrix-canvas'),
  ctx: null,
  chars: "01EXOROBOURII",
  drops: [],
  fontSize: 14,
  
  init() {
    this.ctx = this.canvas.getContext('2d');
    this.resize();
    window.addEventListener('resize', () => this.resize());
    
    const columns = this.canvas.width / this.fontSize;
    for(let i=0; i<columns; i++) this.drops[i] = 1;
    
    setInterval(() => this.draw(), 50);
  },

  resize() {
    this.canvas.width = window.innerWidth;
    this.canvas.height = window.innerHeight;
  },

  draw() {
    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
    
    this.ctx.fillStyle = '#0F0';
    this.ctx.font = this.fontSize + 'px monospace';
    
    for(let i=0; i<this.drops.length; i++) {
      const text = this.chars.charAt(Math.floor(Math.random()*this.chars.length));
      
      // Random cyan characters
      if(Math.random() > 0.95) this.ctx.fillStyle = '#38bdf8';
      else this.ctx.fillStyle = '#0ea5e9';
      
      this.ctx.fillText(text, i*this.fontSize, this.drops[i]*this.fontSize);
      
      if(this.drops[i]*this.fontSize > this.canvas.height && Math.random() > 0.975)
        this.drops[i] = 0;
      
      this.drops[i]++;
    }
  }
};

/* --- 3. FILE SYSTEM --- */
const FileSystem = {
  "~": {
    "projects": { type: "dir", content: ["janus", "vsm", "glass_box.md"] },
    "research": { type: "dir", content: ["whitepaper.txt", "notes.log"] },
    "team": { type: "dir", content: ["founder.txt", "coffee_incident.log"] },
    "README.md": { type: "file", content: "Welcome to Exorobourii.\n\nWe believe in Glass Box development.\nExplore the system.\n\nTry: 'ls', 'cd projects', 'cat README.md'" }
  },
  "~/projects": {
    "janus": { type: "dir", content: ["data.csv", "model.py"] },
    "glass_box.md": { type: "file", content: "# Glass Box Philosophy\n\nIf you can't explain it, you don't understand it.\nWe build AI we can see inside." }
  },
  "~/team": {
    "founder.txt": { type: "file", content: "Jonathan Belanger\nFounder & Research Lead\n\nStatus: Debugging reality." },
    "coffee_incident.log": { type: "file", content: "INCIDENT #847\n\nSubject: Coffee Machine\nStatus: Sentient\nAction: Refused to brew decaf on moral grounds." }
  }
};

/* --- 4. TERMINAL LOGIC --- */
const Terminal = {
  input: document.getElementById('cli'),
  output: document.getElementById('output'),
  prompt: document.getElementById('prompt-span'),
  currentPath: "~",
  history: [],
  historyIndex: -1,
  isProcessing: false,

  init() {
    // FOCUS TRAP: Ensure input always has focus
    document.addEventListener('click', () => this.input.focus());
    this.input.focus();

    this.input.addEventListener('keydown', (e) => {
      if (this.isProcessing) {
        e.preventDefault();
        return;
      }
      
      if (e.key === 'Enter') {
        const cmd = this.input.value;
        this.input.value = '';
        this.handleCommand(cmd);
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (this.historyIndex > 0) {
          this.historyIndex--;
          this.input.value = this.history[this.historyIndex];
        }
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (this.historyIndex < this.history.length - 1) {
          this.historyIndex++;
          this.input.value = this.history[this.historyIndex];
        } else {
          this.historyIndex = this.history.length;
          this.input.value = '';
        }
      } else if (e.key === 'Tab') {
        e.preventDefault();
        this.doTabCompletion();
      } else {
        AudioEngine.playKey();
      }
    });
  },

  async handleCommand(fullCmd) {
    if (!fullCmd.trim()) return;
    
    AudioEngine.playEnter();
    this.history.push(fullCmd);
    this.historyIndex = this.history.length;

    // Echo command
    this.print(`guest@exorobourii:${this.currentPath.replace("~","")}$ ${fullCmd}`, "dim");

    const parts = fullCmd.trim().split(' ');
    const cmd = parts[0].toLowerCase();
    const args = parts.slice(1);

    switch(cmd) {
      case 'help':
        this.print("COMMANDS: ls, cd, cat, pwd, clear, whoami, reboot, date, theme");
        break;
      
      case 'ls':
        const dir = this.resolveDir(args[0]);
        if (dir) {
          const items = Object.keys(dir).map(k => dir[k].type === 'dir' ? `<span class="cyan">${k}/</span>` : k);
          this.print(items.join('  '));
        } else {
          this.print(`ls: cannot access '${args[0] || ''}': No such directory`, "red");
          AudioEngine.playError();
        }
        break;

      case 'cd':
        const target = args[0] || "~";
        if (target === "..") {
          const parts = this.currentPath.split('/');
          if (parts.length > 1) parts.pop();
          this.currentPath = parts.join('/') || "~";
        } else {
          const newPath = this.resolvePath(target);
          if (FileSystem[newPath] && FileSystem[newPath].type !== 'file') {
            this.currentPath = newPath;
          } else {
            this.print(`cd: ${target}: No such directory`, "red");
            AudioEngine.playError();
          }
        }
        this.updatePrompt();
        break;

      case 'cat':
        const file = this.resolvePath(args[0]);
        const parent = file.substring(0, file.lastIndexOf('/')) || "~";
        const fname = file.substring(file.lastIndexOf('/') + 1);
        const folder = FileSystem[parent];
        
        if (folder && folder[fname]) {
          if (folder[fname].type === 'dir') this.print(`cat: ${fname}: Is a directory`, "red");
          else await this.streamText(folder[fname].content);
        } else {
          this.print(`cat: ${args[0]}: No such file`, "red");
          AudioEngine.playError();
        }
        break;

      case 'clear':
        this.output.innerHTML = '';
        break;

      case 'pwd':
        this.print(this.currentPath);
        break;
        
      case 'whoami':
        this.print("guest");
        break;

      case 'reboot':
        document.querySelector('.screen').classList.add('shutdown');
        setTimeout(() => location.reload(), 1000);
        break;
        
      case 'sudo':
        this.print("guest is not in the sudoers file. This incident will be reported.", "red");
        AudioEngine.playError();
        break;

      case 'xyzzy':
        this.print("Nothing happens.", "dim");
        break;
        
      case 'coffee':
        this.print("Error: HTCPCP/1.0 418 I'm a teapot", "yellow");
        break;

      default:
        this.print(`bash: ${cmd}: command not found`, "red");
        AudioEngine.playError();
    }
  },

  resolvePath(path) {
    if (!path) return this.currentPath;
    if (path.startsWith('~')) return path;
    if (path.startsWith('/')) return '~' + path;
    return this.currentPath === '~' ? `~/${path}` : `${this.currentPath}/${path}`;
  },

  resolveDir(path) {
    const p = this.resolvePath(path);
    return FileSystem[p];
  },

  updatePrompt() {
    const p = this.currentPath === "~" ? "~" : this.currentPath.replace("~", "");
    this.prompt.innerHTML = `guest@exorobourii:<span class="cyan">${p}</span>$`;
  },

  print(html, className = "") {
    const div = document.createElement('div');
    div.className = `line ${className}`;
    div.innerHTML = html;
    this.output.appendChild(div);
    this.output.scrollTop = this.output.scrollHeight;
  },

  async streamText(text) {
    this.isProcessing = true;
    const div = document.createElement('div');
    div.className = 'line';
    this.output.appendChild(div);
    
    for (let char of text) {
      div.innerHTML += char === '\n' ? '<br>' : char;
      this.output.scrollTop = this.output.scrollHeight;
      await new Promise(r => setTimeout(r, 10)); // Typing speed
    }
    this.isProcessing = false;
  },

  doTabCompletion() {
    const val = this.input.value;
    const parts = val.split(' ');
    const last = parts[parts.length - 1];
    const dir = FileSystem[this.currentPath];
    
    if (!dir) return;
    const matches = Object.keys(dir).filter(k => k.startsWith(last));
    
    if (matches.length === 1) {
      parts[parts.length - 1] = matches[0];
      this.input.value = parts.join(' ');
    } else if (matches.length > 1) {
      this.print(matches.join('  '), "dim");
    }
  }
};

/* --- 5. BOOT SEQUENCE --- */
const BootLoader = {
  screen: document.getElementById('boot-screen'),
  text: document.getElementById('boot-text'),
  prompt: document.getElementById('click-prompt'),
  
  async start() {
    await this.print("EXOROBOURII BIOS v4.2");
    await this.wait(200);
    await this.print("Checking Memory... 64TB OK");
    await this.print("Mounting VFS... OK");
    await this.print("Initializing Neural Link... OK");
    await this.wait(400);
    
    this.prompt.classList.remove('hidden');
    
    const unlock = () => {
      document.removeEventListener('keydown', unlock);
      document.removeEventListener('click', unlock);
      this.enter();
    };
    
    document.addEventListener('keydown', unlock);
    document.addEventListener('click', unlock);
  },

  async enter() {
    AudioEngine.init();
    AudioEngine.playBoot();
    
    this.screen.classList.add('hidden');
    document.getElementById('main-terminal').classList.remove('hidden');
    document.getElementById('navbar').style.opacity = 1;
    
    Matrix.init();
    Terminal.init(); // Initialize terminal AFTER DOM is visible
    
    await Terminal.streamText("Welcome to Exorobourii Research Systems.\nGlass box development environment loaded.\n\nType 'help' for commands.");
  },

  print(txt) {
    const div = document.createElement('div');
    div.innerText = txt;
    this.text.appendChild(div);
    return new Promise(r => setTimeout(r, 100));
  },

  wait(ms) { return new Promise(r => setTimeout(r, ms)); }
};

window.onload = () => BootLoader.start();

</script>
</body>
</html>